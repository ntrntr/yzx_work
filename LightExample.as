package
{
    import com.adobe.utils.AGALMiniAssembler;
    import com.adobe.utils.PerspectiveMatrix3D;
    
    import flash.display.Sprite;
    import flash.display.Stage3D;
    import flash.display.StageAlign;
    import flash.display.StageScaleMode;
    import flash.display3D.Context3D;
    import flash.display3D.Context3DProgramType;
    import flash.display3D.Context3DTextureFormat;
    import flash.display3D.Context3DVertexBufferFormat;
    import flash.display3D.IndexBuffer3D;
    import flash.display3D.Program3D;
    import flash.display3D.VertexBuffer3D;
    import flash.events.Event;
    import flash.geom.Matrix3D;
    
    [SWF(width="640", height="480", frameRate="60", backgroundColor="#000000")]	
    public class LightExample extends Sprite
    {
        // constants used during inits
        private const swfWidth:int = 640;
        private const swfHeight:int = 480;
        private const textureSize:int = 2;
        
        // the 3d graphics window on the stage
        private var context3D:Context3D;
        // the compiled shader used to render our mesh
        private var shaderProgram:Program3D;
        // the uploaded verteces used by our mesh
        private var vertexBuffer:VertexBuffer3D;
        // the uploaded indeces of each vertex of the mesh
        private var indexBuffer:IndexBuffer3D;
        // the data that defines our 3d mesh model
        private var meshVertexData:Vector.<Number>;
        // the indeces that define what data is used by each vertex
        private var meshIndexData:Vector.<uint>;
        
        // matrices that affect the mesh location and camera angles
        private var projectionMatrix:PerspectiveMatrix3D = new PerspectiveMatrix3D();
        private var modelMatrix:Matrix3D = new Matrix3D();
        private var viewMatrix:Matrix3D = new Matrix3D();
        private var modelViewProjection:Matrix3D = new Matrix3D()

        public function LightExample()
        {
            if (stage != null) 
                init();
            else 
                addEventListener(Event.ADDED_TO_STAGE, init); 
        }
        
        private function init(e:Event = null):void 
        {
            if (hasEventListener(Event.ADDED_TO_STAGE))
                removeEventListener(Event.ADDED_TO_STAGE, init);
        
            stage.frameRate = 60;
            stage.scaleMode = StageScaleMode.NO_SCALE;
            stage.align = StageAlign.TOP_LEFT;
        
            // and request a context3D from Stage3d
            stage.stage3Ds[0].addEventListener(
                Event.CONTEXT3D_CREATE, onContext3DCreate);
            stage.stage3Ds[0].requestContext3D();
        }
        
        private function onContext3DCreate(event:Event):void 
        {
            // Remove existing frame handler. Note that a context
            // loss can occur at any time which will force you
            // to recreate all objects we create here.
            // A context loss occurs for instance if you hit
            // CTRL-ALT-DELETE on Windows.			
            // It takes a while before a new context is available
            // hence removing the enterFrame handler is important!
            
            if (hasEventListener(Event.ENTER_FRAME))
                removeEventListener(Event.ENTER_FRAME, enterFrame);
            
            // Obtain the current context
            var t:Stage3D = event.target as Stage3D;					
            context3D = t.context3D; 	
            
            if (context3D == null) 
            {
                // Currently no 3d context is available (error!)
                return;
            }
            
            // Disabling error checking will drastically improve performance.
            // If set to true, Flash will send helpful error messages regarding
            // AGAL compilation errors, uninitialized program constants, etc.
            context3D.enableErrorChecking = true;
            
            // Initialize our mesh data
            initData();
            
            // The 3d back buffer size is in pixels
            context3D.configureBackBuffer(swfWidth, swfHeight, 0, true);
            
            // A simple vertex shader which does a 3D transformation
            var vertexShaderAssembler:AGALMiniAssembler = new AGALMiniAssembler();
            vertexShaderAssembler.assemble
                ( 
                    Context3DProgramType.VERTEX,
                    // 4x4 matrix multiply to get camera angle	
                    "m44 op, va0, vc0\n" +
                    // tell fragment shader about XYZ
                    "mov vt0, va0\n" + 
					//normal
					"nrm vt0.xyz, vt0.xyz\n" + 
					//move
					"mov v0,vt0"
                );			
            
            // A simple fragment shader which will use the vertex position as a color
            var fragmentShaderAssembler:AGALMiniAssembler = new AGALMiniAssembler();
            fragmentShaderAssembler.assemble
                ( 
                    Context3DProgramType.FRAGMENT,	
                    // grab the texture color from texture fs0
                    // using the UV coordinates stored in v1
                    // move this value to the output color
					//neg light direction
					"mov ft0, fc1\n"  + 
					//neg
					"neg ft0, ft0\n" + 
					//nor
					"nrm ft0.xyz, ft0.xyz\n" + 
					//Ld*Md
					"mov ft1, fc2\n" + 
					"mul ft1.xyz, ft1.xyz, fc3.xyz\n" + 
					//L*n
					"dp3 ft2.x, v0, ft0\n" + 
					//max(0, L*n)
					"max ft3.x, fc0.x, ft2.x\n" + 
					//ft4 = 1 * max(0, L dot n)Ld * Md, diffuse
					"mul ft4.xyz, ft1.xyz, ft3.xxx\n" + 
					//ft1 = 1 * La * Ma
					"add ft4.xyz, ft4.xyz, ft1.xyz\n" + 
					//"neg v1, v1\n" 
					//nor the light direction
					//"nrm v1, v1\n"
                    "mov oc, ft4.xyz\n"
                );
            
            // combine shaders into a program which we then upload to the GPU
            shaderProgram = context3D.createProgram();
            shaderProgram.upload(vertexShaderAssembler.agalcode, fragmentShaderAssembler.agalcode);
            
            // upload the mesh indexes
            indexBuffer = context3D.createIndexBuffer(meshIndexData.length);
            indexBuffer.uploadFromVector(meshIndexData, 0, meshIndexData.length);
            
            // upload the mesh vertex data
            // since our particular data is 
            // x, y, z, u, v, nx, ny, nz
            // each vertex uses 8 array elements
            vertexBuffer = context3D.createVertexBuffer(meshVertexData.length/3, 3); 
            vertexBuffer.uploadFromVector(meshVertexData, 0, meshVertexData.length/3);
            
            // create projection matrix for our 3D scene
            projectionMatrix.identity();
            // 45 degrees FOV, 640/480 aspect ratio, 0.1=near, 100=far
            projectionMatrix.perspectiveFieldOfViewRH(45.0, swfWidth / swfHeight, 1, 1000.0);
            
            // create a matrix that defines the camera location
            viewMatrix.identity();
            // move the camera back a little so we can see the mesh
            viewMatrix.appendTranslation(0,0,-244);
            
            // start animating
            addEventListener(Event.ENTER_FRAME,enterFrame);
        }
        
        private function enterFrame(e:Event):void 
        {
            // clear scene before rendering is mandatory
            context3D.clear(0,0,0); 
            
            context3D.setProgram ( shaderProgram );
            
            // create the various transformation matrices
            modelMatrix.identity();
            /*            modelMatrix.appendRotation(t*0.7, Vector3D.Y_AXIS);
            modelMatrix.appendRotation(t*0.6, Vector3D.X_AXIS);
            modelMatrix.appendRotation(t*1.0, Vector3D.Y_AXIS);
            modelMatrix.appendTranslation(0.0, 0.0, 0.0);
            modelMatrix.appendRotation(90.0, Vector3D.X_AXIS);
            */            
            // rotate more next frame
            
            // clear the matrix and append new angles
            modelViewProjection.identity();
            modelViewProjection.append(modelMatrix);
            modelViewProjection.append(viewMatrix);
            modelViewProjection.append(projectionMatrix);
            
            // pass our matrix data to the shader program
            context3D.setProgramConstantsFromMatrix(
                Context3DProgramType.VERTEX, 
                0, modelViewProjection, true );
            
//            context3D.setProgramConstantsFromVector(
//                Context3DProgramType.FRAGMENT,
//                0, Vector.<Number>([1, 0, 0, 1]), 1);
            
            // fc0 => positive mask
            // fc1 => light direction
            // fc2 => diffuse color
            // fc3 => ambient color
            context3D.setProgramConstantsFromVector(
                Context3DProgramType.FRAGMENT,
                0,
                Vector.<Number>([0, 0, 0, 0,
                                 -1, 0, 0, 0,
                                 1, 0, 0, 0,
                                 0.2, 0, 0, 0]),
                4);

            // associate the vertex data with current shader program
            // position
            context3D.setVertexBufferAt(0, vertexBuffer, 0, 
                Context3DVertexBufferFormat.FLOAT_3);
            
            // finally draw the triangles
            context3D.drawTriangles(indexBuffer, 0, meshIndexData.length/3);
            
            // present/flip back buffer
            context3D.present();
        }
        
        private function initData():void 
        {
            // Defines which vertex is used for each polygon
            // In this example a square is made from two triangles
            meshIndexData = Vector.<uint> 
                ([
                    1,2,3,
                    1,3,4,
                    1,4,5,
                    1,5,6,
                    1,6,7,
                    1,7,8,
                    1,8,9,
                    1,9,10,
                    1,10,11,
                    1,11,12,
                    1,12,13,
                    1,13,14,
                    1,14,15,
                    1,15,16,
                    1,16,17,
                    1,17,18,
                    1,18,19,
                    1,19,20,
                    1,20,21,
                    1,21,22,
                    1,22,23,
                    1,23,24,
                    1,24,25,
                    1,25,26,
                    1,26,27,
                    1,27,28,
                    1,28,29,
                    1,29,30,
                    1,30,31,
                    1,31,2,
                    2,32,33,
                    2,33,3,
                    3,33,34,
                    3,34,4,
                    4,34,35,
                    4,35,5,
                    5,35,36,
                    5,36,6,
                    6,36,37,
                    6,37,7,
                    7,37,38,
                    7,38,8,
                    8,38,39,
                    8,39,9,
                    9,39,40,
                    9,40,10,
                    10,40,41,
                    10,41,11,
                    11,41,42,
                    11,42,12,
                    12,42,43,
                    12,43,13,
                    13,43,44,
                    13,44,14,
                    14,44,45,
                    14,45,15,
                    15,45,46,
                    15,46,16,
                    16,46,47,
                    16,47,17,
                    17,47,48,
                    17,48,18,
                    18,48,49,
                    18,49,19,
                    19,49,50,
                    19,50,20,
                    20,50,51,
                    20,51,21,
                    21,51,52,
                    21,52,22,
                    22,52,53,
                    22,53,23,
                    23,53,54,
                    23,54,24,
                    24,54,55,
                    24,55,25,
                    25,55,56,
                    25,56,26,
                    26,56,57,
                    26,57,27,
                    27,57,58,
                    27,58,28,
                    28,58,59,
                    28,59,29,
                    29,59,60,
                    29,60,30,
                    30,60,61,
                    30,61,31,
                    31,61,32,
                    31,32,2,
                    32,62,63,
                    32,63,33,
                    33,63,64,
                    33,64,34,
                    34,64,65,
                    34,65,35,
                    35,65,66,
                    35,66,36,
                    36,66,67,
                    36,67,37,
                    37,67,68,
                    37,68,38,
                    38,68,69,
                    38,69,39,
                    39,69,70,
                    39,70,40,
                    40,70,71,
                    40,71,41,
                    41,71,72,
                    41,72,42,
                    42,72,73,
                    42,73,43,
                    43,73,74,
                    43,74,44,
                    44,74,75,
                    44,75,45,
                    45,75,76,
                    45,76,46,
                    46,76,77,
                    46,77,47,
                    47,77,78,
                    47,78,48,
                    48,78,79,
                    48,79,49,
                    49,79,80,
                    49,80,50,
                    50,80,81,
                    50,81,51,
                    51,81,82,
                    51,82,52,
                    52,82,83,
                    52,83,53,
                    53,83,84,
                    53,84,54,
                    54,84,85,
                    54,85,55,
                    55,85,86,
                    55,86,56,
                    56,86,87,
                    56,87,57,
                    57,87,88,
                    57,88,58,
                    58,88,89,
                    58,89,59,
                    59,89,90,
                    59,90,60,
                    60,90,91,
                    60,91,61,
                    61,91,62,
                    61,62,32,
                    62,92,93,
                    62,93,63,
                    63,93,94,
                    63,94,64,
                    64,94,95,
                    64,95,65,
                    65,95,96,
                    65,96,66,
                    66,96,97,
                    66,97,67,
                    67,97,98,
                    67,98,68,
                    68,98,99,
                    68,99,69,
                    69,99,100,
                    69,100,70,
                    70,100,101,
                    70,101,71,
                    71,101,102,
                    71,102,72,
                    72,102,103,
                    72,103,73,
                    73,103,104,
                    73,104,74,
                    74,104,105,
                    74,105,75,
                    75,105,106,
                    75,106,76,
                    76,106,107,
                    76,107,77,
                    77,107,108,
                    77,108,78,
                    78,108,109,
                    78,109,79,
                    79,109,110,
                    79,110,80,
                    80,110,111,
                    80,111,81,
                    81,111,112,
                    81,112,82,
                    82,112,113,
                    82,113,83,
                    83,113,114,
                    83,114,84,
                    84,114,115,
                    84,115,85,
                    85,115,116,
                    85,116,86,
                    86,116,117,
                    86,117,87,
                    87,117,118,
                    87,118,88,
                    88,118,119,
                    88,119,89,
                    89,119,120,
                    89,120,90,
                    90,120,121,
                    90,121,91,
                    91,121,92,
                    91,92,62,
                    92,122,123,
                    92,123,93,
                    93,123,124,
                    93,124,94,
                    94,124,125,
                    94,125,95,
                    95,125,126,
                    95,126,96,
                    96,126,127,
                    96,127,97,
                    97,127,128,
                    97,128,98,
                    98,128,129,
                    98,129,99,
                    99,129,130,
                    99,130,100,
                    100,130,131,
                    100,131,101,
                    101,131,132,
                    101,132,102,
                    102,132,133,
                    102,133,103,
                    103,133,134,
                    103,134,104,
                    104,134,135,
                    104,135,105,
                    105,135,136,
                    105,136,106,
                    106,136,137,
                    106,137,107,
                    107,137,138,
                    107,138,108,
                    108,138,139,
                    108,139,109,
                    109,139,140,
                    109,140,110,
                    110,140,141,
                    110,141,111,
                    111,141,142,
                    111,142,112,
                    112,142,143,
                    112,143,113,
                    113,143,144,
                    113,144,114,
                    114,144,145,
                    114,145,115,
                    115,145,146,
                    115,146,116,
                    116,146,147,
                    116,147,117,
                    117,147,148,
                    117,148,118,
                    118,148,149,
                    118,149,119,
                    119,149,150,
                    119,150,120,
                    120,150,151,
                    120,151,121,
                    121,151,122,
                    121,122,92,
                    122,152,153,
                    122,153,123,
                    123,153,154,
                    123,154,124,
                    124,154,155,
                    124,155,125,
                    125,155,156,
                    125,156,126,
                    126,156,157,
                    126,157,127,
                    127,157,158,
                    127,158,128,
                    128,158,159,
                    128,159,129,
                    129,159,160,
                    129,160,130,
                    130,160,161,
                    130,161,131,
                    131,161,162,
                    131,162,132,
                    132,162,163,
                    132,163,133,
                    133,163,164,
                    133,164,134,
                    134,164,165,
                    134,165,135,
                    135,165,166,
                    135,166,136,
                    136,166,167,
                    136,167,137,
                    137,167,168,
                    137,168,138,
                    138,168,169,
                    138,169,139,
                    139,169,170,
                    139,170,140,
                    140,170,171,
                    140,171,141,
                    141,171,172,
                    141,172,142,
                    142,172,173,
                    142,173,143,
                    143,173,174,
                    143,174,144,
                    144,174,175,
                    144,175,145,
                    145,175,176,
                    145,176,146,
                    146,176,177,
                    146,177,147,
                    147,177,178,
                    147,178,148,
                    148,178,179,
                    148,179,149,
                    149,179,180,
                    149,180,150,
                    150,180,181,
                    150,181,151,
                    151,181,152,
                    151,152,122,
                    152,182,183,
                    152,183,153,
                    153,183,184,
                    153,184,154,
                    154,184,185,
                    154,185,155,
                    155,185,186,
                    155,186,156,
                    156,186,187,
                    156,187,157,
                    157,187,188,
                    157,188,158,
                    158,188,189,
                    158,189,159,
                    159,189,190,
                    159,190,160,
                    160,190,191,
                    160,191,161,
                    161,191,192,
                    161,192,162,
                    162,192,193,
                    162,193,163,
                    163,193,194,
                    163,194,164,
                    164,194,195,
                    164,195,165,
                    165,195,196,
                    165,196,166,
                    166,196,197,
                    166,197,167,
                    167,197,198,
                    167,198,168,
                    168,198,199,
                    168,199,169,
                    169,199,200,
                    169,200,170,
                    170,200,201,
                    170,201,171,
                    171,201,202,
                    171,202,172,
                    172,202,203,
                    172,203,173,
                    173,203,204,
                    173,204,174,
                    174,204,205,
                    174,205,175,
                    175,205,206,
                    175,206,176,
                    176,206,207,
                    176,207,177,
                    177,207,208,
                    177,208,178,
                    178,208,209,
                    178,209,179,
                    179,209,210,
                    179,210,180,
                    180,210,211,
                    180,211,181,
                    181,211,182,
                    181,182,152,
                    182,212,213,
                    182,213,183,
                    183,213,214,
                    183,214,184,
                    184,214,215,
                    184,215,185,
                    185,215,216,
                    185,216,186,
                    186,216,217,
                    186,217,187,
                    187,217,218,
                    187,218,188,
                    188,218,219,
                    188,219,189,
                    189,219,220,
                    189,220,190,
                    190,220,221,
                    190,221,191,
                    191,221,222,
                    191,222,192,
                    192,222,223,
                    192,223,193,
                    193,223,224,
                    193,224,194,
                    194,224,225,
                    194,225,195,
                    195,225,226,
                    195,226,196,
                    196,226,227,
                    196,227,197,
                    197,227,228,
                    197,228,198,
                    198,228,229,
                    198,229,199,
                    199,229,230,
                    199,230,200,
                    200,230,231,
                    200,231,201,
                    201,231,232,
                    201,232,202,
                    202,232,233,
                    202,233,203,
                    203,233,234,
                    203,234,204,
                    204,234,235,
                    204,235,205,
                    205,235,236,
                    205,236,206,
                    206,236,237,
                    206,237,207,
                    207,237,238,
                    207,238,208,
                    208,238,239,
                    208,239,209,
                    209,239,240,
                    209,240,210,
                    210,240,241,
                    210,241,211,
                    211,241,212,
                    211,212,182,
                    212,242,243,
                    212,243,213,
                    213,243,244,
                    213,244,214,
                    214,244,245,
                    214,245,215,
                    215,245,246,
                    215,246,216,
                    216,246,247,
                    216,247,217,
                    217,247,248,
                    217,248,218,
                    218,248,249,
                    218,249,219,
                    219,249,250,
                    219,250,220,
                    220,250,251,
                    220,251,221,
                    221,251,252,
                    221,252,222,
                    222,252,253,
                    222,253,223,
                    223,253,254,
                    223,254,224,
                    224,254,255,
                    224,255,225,
                    225,255,256,
                    225,256,226,
                    226,256,257,
                    226,257,227,
                    227,257,258,
                    227,258,228,
                    228,258,259,
                    228,259,229,
                    229,259,260,
                    229,260,230,
                    230,260,261,
                    230,261,231,
                    231,261,262,
                    231,262,232,
                    232,262,263,
                    232,263,233,
                    233,263,264,
                    233,264,234,
                    234,264,265,
                    234,265,235,
                    235,265,266,
                    235,266,236,
                    236,266,267,
                    236,267,237,
                    237,267,268,
                    237,268,238,
                    238,268,269,
                    238,269,239,
                    239,269,270,
                    239,270,240,
                    240,270,271,
                    240,271,241,
                    241,271,242,
                    241,242,212,
                    242,272,273,
                    242,273,243,
                    243,273,274,
                    243,274,244,
                    244,274,275,
                    244,275,245,
                    245,275,276,
                    245,276,246,
                    246,276,277,
                    246,277,247,
                    247,277,278,
                    247,278,248,
                    248,278,279,
                    248,279,249,
                    249,279,280,
                    249,280,250,
                    250,280,281,
                    250,281,251,
                    251,281,282,
                    251,282,252,
                    252,282,283,
                    252,283,253,
                    253,283,284,
                    253,284,254,
                    254,284,285,
                    254,285,255,
                    255,285,286,
                    255,286,256,
                    256,286,287,
                    256,287,257,
                    257,287,288,
                    257,288,258,
                    258,288,289,
                    258,289,259,
                    259,289,290,
                    259,290,260,
                    260,290,291,
                    260,291,261,
                    261,291,292,
                    261,292,262,
                    262,292,293,
                    262,293,263,
                    263,293,294,
                    263,294,264,
                    264,294,295,
                    264,295,265,
                    265,295,296,
                    265,296,266,
                    266,296,297,
                    266,297,267,
                    267,297,298,
                    267,298,268,
                    268,298,299,
                    268,299,269,
                    269,299,300,
                    269,300,270,
                    270,300,301,
                    270,301,271,
                    271,301,272,
                    271,272,242,
                    272,302,303,
                    272,303,273,
                    273,303,304,
                    273,304,274,
                    274,304,305,
                    274,305,275,
                    275,305,306,
                    275,306,276,
                    276,306,307,
                    276,307,277,
                    277,307,308,
                    277,308,278,
                    278,308,309,
                    278,309,279,
                    279,309,310,
                    279,310,280,
                    280,310,311,
                    280,311,281,
                    281,311,312,
                    281,312,282,
                    282,312,313,
                    282,313,283,
                    283,313,314,
                    283,314,284,
                    284,314,315,
                    284,315,285,
                    285,315,316,
                    285,316,286,
                    286,316,317,
                    286,317,287,
                    287,317,318,
                    287,318,288,
                    288,318,319,
                    288,319,289,
                    289,319,320,
                    289,320,290,
                    290,320,321,
                    290,321,291,
                    291,321,322,
                    291,322,292,
                    292,322,323,
                    292,323,293,
                    293,323,324,
                    293,324,294,
                    294,324,325,
                    294,325,295,
                    295,325,326,
                    295,326,296,
                    296,326,327,
                    296,327,297,
                    297,327,328,
                    297,328,298,
                    298,328,329,
                    298,329,299,
                    299,329,330,
                    299,330,300,
                    300,330,331,
                    300,331,301,
                    301,331,302,
                    301,302,272,
                    302,332,333,
                    302,333,303,
                    303,333,334,
                    303,334,304,
                    304,334,335,
                    304,335,305,
                    305,335,336,
                    305,336,306,
                    306,336,337,
                    306,337,307,
                    307,337,338,
                    307,338,308,
                    308,338,339,
                    308,339,309,
                    309,339,340,
                    309,340,310,
                    310,340,341,
                    310,341,311,
                    311,341,342,
                    311,342,312,
                    312,342,343,
                    312,343,313,
                    313,343,344,
                    313,344,314,
                    314,344,345,
                    314,345,315,
                    315,345,346,
                    315,346,316,
                    316,346,347,
                    316,347,317,
                    317,347,348,
                    317,348,318,
                    318,348,349,
                    318,349,319,
                    319,349,350,
                    319,350,320,
                    320,350,351,
                    320,351,321,
                    321,351,352,
                    321,352,322,
                    322,352,353,
                    322,353,323,
                    323,353,354,
                    323,354,324,
                    324,354,355,
                    324,355,325,
                    325,355,356,
                    325,356,326,
                    326,356,357,
                    326,357,327,
                    327,357,358,
                    327,358,328,
                    328,358,359,
                    328,359,329,
                    329,359,360,
                    329,360,330,
                    330,360,361,
                    330,361,331,
                    331,361,332,
                    331,332,302,
                    332,362,363,
                    332,363,333,
                    333,363,364,
                    333,364,334,
                    334,364,365,
                    334,365,335,
                    335,365,366,
                    335,366,336,
                    336,366,367,
                    336,367,337,
                    337,367,368,
                    337,368,338,
                    338,368,369,
                    338,369,339,
                    339,369,370,
                    339,370,340,
                    340,370,371,
                    340,371,341,
                    341,371,372,
                    341,372,342,
                    342,372,373,
                    342,373,343,
                    343,373,374,
                    343,374,344,
                    344,374,375,
                    344,375,345,
                    345,375,376,
                    345,376,346,
                    346,376,377,
                    346,377,347,
                    347,377,378,
                    347,378,348,
                    348,378,379,
                    348,379,349,
                    349,379,380,
                    349,380,350,
                    350,380,381,
                    350,381,351,
                    351,381,382,
                    351,382,352,
                    352,382,383,
                    352,383,353,
                    353,383,384,
                    353,384,354,
                    354,384,385,
                    354,385,355,
                    355,385,386,
                    355,386,356,
                    356,386,387,
                    356,387,357,
                    357,387,388,
                    357,388,358,
                    358,388,389,
                    358,389,359,
                    359,389,390,
                    359,390,360,
                    360,390,391,
                    360,391,361,
                    361,391,362,
                    361,362,332,
                    362,392,393,
                    362,393,363,
                    363,393,394,
                    363,394,364,
                    364,394,395,
                    364,395,365,
                    365,395,396,
                    365,396,366,
                    366,396,397,
                    366,397,367,
                    367,397,398,
                    367,398,368,
                    368,398,399,
                    368,399,369,
                    369,399,400,
                    369,400,370,
                    370,400,401,
                    370,401,371,
                    371,401,402,
                    371,402,372,
                    372,402,403,
                    372,403,373,
                    373,403,404,
                    373,404,374,
                    374,404,405,
                    374,405,375,
                    375,405,406,
                    375,406,376,
                    376,406,407,
                    376,407,377,
                    377,407,408,
                    377,408,378,
                    378,408,409,
                    378,409,379,
                    379,409,410,
                    379,410,380,
                    380,410,411,
                    380,411,381,
                    381,411,412,
                    381,412,382,
                    382,412,413,
                    382,413,383,
                    383,413,414,
                    383,414,384,
                    384,414,415,
                    384,415,385,
                    385,415,416,
                    385,416,386,
                    386,416,417,
                    386,417,387,
                    387,417,418,
                    387,418,388,
                    388,418,419,
                    388,419,389,
                    389,419,420,
                    389,420,390,
                    390,420,421,
                    390,421,391,
                    391,421,392,
                    391,392,362,
                    422,393,392,
                    422,394,393,
                    422,395,394,
                    422,396,395,
                    422,397,396,
                    422,398,397,
                    422,399,398,
                    422,400,399,
                    422,401,400,
                    422,402,401,
                    422,403,402,
                    422,404,403,
                    422,405,404,
                    422,406,405,
                    422,407,406,
                    422,408,407,
                    422,409,408,
                    422,410,409,
                    422,411,410,
                    422,412,411,
                    422,413,412,
                    422,414,413,
                    422,415,414,
                    422,416,415,
                    422,417,416,
                    422,418,417,
                    422,419,418,
                    422,420,419,
                    422,421,420,
                    422,392,421
                ]);
            
            for (var i:int = 0; i < meshIndexData.length; i++)
            {
                meshIndexData[i] -= 1;
            }

            // Raw data used for each of the 4 verteces
            // Position XYZ, texture coordinate UV, normal XYZ
            meshVertexData = Vector.<Number> 
                ( [
                    0.0000,100.0000,-0.0000,
                    -0.0000,97.8148,-20.7912,
                    -4.3227,97.8148,-20.3368,
                    -8.4565,97.8148,-18.9937,
                    -12.2207,97.8148,-16.8204,
                    -15.4509,97.8148,-13.9120,
                    -18.0057,97.8148,-10.3956,
                    -19.7736,97.8148,-6.4248,
                    -20.6773,97.8148,-2.1733,
                    -20.6773,97.8148,2.1733,
                    -19.7736,97.8148,6.4248,
                    -18.0057,97.8148,10.3956,
                    -15.4508,97.8148,13.9120,
                    -12.2207,97.8148,16.8204,
                    -8.4565,97.8148,18.9937,
                    -4.3227,97.8148,20.3368,
                    0.0000,97.8148,20.7912,
                    4.3228,97.8148,20.3368,
                    8.4566,97.8148,18.9937,
                    12.2208,97.8148,16.8204,
                    15.4509,97.8148,13.9120,
                    18.0057,97.8148,10.3955,
                    19.7736,97.8148,6.4248,
                    20.6773,97.8148,2.1732,
                    20.6773,97.8148,-2.1733,
                    19.7736,97.8148,-6.4249,
                    18.0056,97.8148,-10.3956,
                    15.4508,97.8148,-13.9121,
                    12.2207,97.8148,-16.8205,
                    8.4565,97.8148,-18.9937,
                    4.3226,97.8148,-20.3369,
                    -0.0000,91.3545,-40.6737,
                    -8.4565,91.3545,-39.7849,
                    -16.5435,91.3545,-37.1572,
                    -23.9074,91.3545,-32.9057,
                    -30.2264,91.3545,-27.2160,
                    -35.2244,91.3545,-20.3368,
                    -38.6830,91.3545,-12.5688,
                    -40.4509,91.3545,-4.2515,
                    -40.4509,91.3545,4.2516,
                    -38.6830,91.3545,12.5689,
                    -35.2244,91.3545,20.3368,
                    -30.2264,91.3545,27.2160,
                    -23.9074,91.3545,32.9057,
                    -16.5435,91.3545,37.1573,
                    -8.4565,91.3545,39.7849,
                    0.0000,91.3545,40.6737,
                    8.4566,91.3545,39.7848,
                    16.5435,91.3545,37.1572,
                    23.9074,91.3545,32.9056,
                    30.2265,91.3545,27.2159,
                    35.2245,91.3545,20.3368,
                    38.6830,91.3545,12.5688,
                    40.4509,91.3545,4.2514,
                    40.4508,91.3545,-4.2517,
                    38.6829,91.3545,-12.5690,
                    35.2244,91.3545,-20.3370,
                    30.2263,91.3545,-27.2161,
                    23.9073,91.3545,-32.9058,
                    16.5433,91.3545,-37.1573,
                    8.4564,91.3545,-39.7849,
                    -0.0000,80.9017,-58.7785,
                    -12.2207,80.9017,-57.4941,
                    -23.9074,80.9017,-53.6969,
                    -34.5492,80.9017,-47.5528,
                    -43.6810,80.9017,-39.3305,
                    -50.9037,80.9017,-29.3893,
                    -55.9017,80.9017,-18.1636,
                    -58.4565,80.9017,-6.1440,
                    -58.4565,80.9017,6.1440,
                    -55.9017,80.9017,18.1636,
                    -50.9037,80.9017,29.3893,
                    -43.6810,80.9017,39.3305,
                    -34.5491,80.9017,47.5528,
                    -23.9074,80.9017,53.6969,
                    -12.2207,80.9017,57.4941,
                    0.0001,80.9017,58.7785,
                    12.2208,80.9017,57.4941,
                    23.9075,80.9017,53.6968,
                    34.5492,80.9017,47.5528,
                    43.6810,80.9017,39.3304,
                    50.9038,80.9017,29.3892,
                    55.9017,80.9017,18.1634,
                    58.4566,80.9017,6.1439,
                    58.4565,80.9017,-6.1442,
                    55.9016,80.9017,-18.1637,
                    50.9036,80.9017,-29.3894,
                    43.6808,80.9017,-39.3307,
                    34.5490,80.9017,-47.5530,
                    23.9072,80.9017,-53.6970,
                    12.2205,80.9017,-57.4941,
                    -0.0000,66.9131,-74.3145,
                    -15.4509,66.9131,-72.6905,
                    -30.2264,66.9131,-67.8897,
                    -43.6810,66.9131,-60.1217,
                    -55.2264,66.9131,-49.7261,
                    -64.3582,66.9131,-37.1572,
                    -70.6773,66.9131,-22.9644,
                    -73.9074,66.9131,-7.7680,
                    -73.9074,66.9131,7.7680,
                    -70.6773,66.9131,22.9645,
                    -64.3582,66.9131,37.1573,
                    -55.2264,66.9131,49.7261,
                    -43.6809,66.9131,60.1217,
                    -30.2264,66.9131,67.8897,
                    -15.4508,66.9131,72.6905,
                    0.0001,66.9131,74.3145,
                    15.4509,66.9131,72.6905,
                    30.2265,66.9131,67.8896,
                    43.6811,66.9131,60.1216,
                    55.2265,66.9131,49.7260,
                    64.3583,66.9131,37.1571,
                    70.6773,66.9131,22.9643,
                    73.9074,66.9131,7.7678,
                    73.9074,66.9131,-7.7682,
                    70.6772,66.9131,-22.9647,
                    64.3581,66.9131,-37.1575,
                    55.2262,66.9131,-49.7263,
                    43.6807,66.9131,-60.1218,
                    30.2261,66.9131,-67.8898,
                    15.4505,66.9131,-72.6906,
                    -0.0000,50.0000,-86.6026,
                    -18.0057,50.0000,-84.7101,
                    -35.2244,50.0000,-79.1154,
                    -50.9037,50.0000,-70.0629,
                    -64.3582,50.0000,-57.9484,
                    -75.0000,50.0000,-43.3013,
                    -82.3639,50.0000,-26.7616,
                    -86.1281,50.0000,-9.0524,
                    -86.1281,50.0000,9.0525,
                    -82.3639,50.0000,26.7617,
                    -75.0000,50.0000,43.3013,
                    -64.3582,50.0000,57.9484,
                    -50.9037,50.0000,70.0630,
                    -35.2244,50.0000,79.1154,
                    -18.0056,50.0000,84.7101,
                    0.0001,50.0000,86.6026,
                    18.0058,50.0000,84.7101,
                    35.2245,50.0000,79.1153,
                    50.9038,50.0000,70.0629,
                    64.3584,50.0000,57.9483,
                    75.0001,50.0000,43.3011,
                    82.3640,50.0000,26.7615,
                    86.1282,50.0000,9.0522,
                    86.1281,50.0000,-9.0527,
                    82.3638,50.0000,-26.7619,
                    74.9999,50.0000,-43.3015,
                    64.3580,50.0000,-57.9487,
                    50.9034,50.0000,-70.0631,
                    35.2241,50.0000,-79.1155,
                    18.0053,50.0000,-84.7102,
                    -0.0000,30.9017,-95.1057,
                    -19.7736,30.9017,-93.0274,
                    -38.6830,30.9017,-86.8833,
                    -55.9017,30.9017,-76.9421,
                    -70.6773,30.9017,-63.6381,
                    -82.3639,30.9017,-47.5528,
                    -90.4509,30.9017,-29.3892,
                    -94.5847,30.9017,-9.9412,
                    -94.5846,30.9017,9.9413,
                    -90.4508,30.9017,29.3893,
                    -82.3639,30.9017,47.5528,
                    -70.6773,30.9017,63.6381,
                    -55.9017,30.9017,76.9421,
                    -38.6829,30.9017,86.8834,
                    -19.7735,30.9017,93.0274,
                    0.0001,30.9017,95.1057,
                    19.7737,30.9017,93.0273,
                    38.6831,30.9017,86.8833,
                    55.9018,30.9017,76.9420,
                    70.6774,30.9017,63.6380,
                    82.3640,30.9017,47.5526,
                    90.4509,30.9017,29.3890,
                    94.5847,30.9017,9.9410,
                    94.5846,30.9017,-9.9415,
                    90.4508,30.9017,-29.3895,
                    82.3637,30.9017,-47.5531,
                    70.6770,30.9017,-63.6384,
                    55.9014,30.9017,-76.9423,
                    38.6826,30.9017,-86.8835,
                    19.7732,30.9017,-93.0275,
                    -0.0000,10.4528,-99.4522,
                    -20.6773,10.4528,-97.2789,
                    -40.4509,10.4528,-90.8541,
                    -58.4566,10.4528,-80.4585,
                    -73.9074,10.4528,-66.5465,
                    -86.1281,10.4528,-49.7261,
                    -94.5847,10.4528,-30.7324,
                    -98.9074,10.4528,-10.3956,
                    -98.9074,10.4528,10.3956,
                    -94.5846,10.4528,30.7324,
                    -86.1281,10.4528,49.7261,
                    -73.9074,10.4528,66.5465,
                    -58.4565,10.4528,80.4585,
                    -40.4508,10.4528,90.8541,
                    -20.6772,10.4528,97.2789,
                    0.0001,10.4528,99.4522,
                    20.6774,10.4528,97.2789,
                    40.4510,10.4528,90.8540,
                    58.4567,10.4528,80.4584,
                    73.9075,10.4528,66.5464,
                    86.1282,10.4528,49.7259,
                    94.5847,10.4528,30.7322,
                    98.9074,10.4528,10.3953,
                    98.9074,10.4528,-10.3959,
                    94.5846,10.4528,-30.7327,
                    86.1280,10.4528,-49.7264,
                    73.9071,10.4528,-66.5468,
                    58.4562,10.4528,-80.4587,
                    40.4505,10.4528,-90.8543,
                    20.6768,10.4528,-97.2790,
                    -0.0000,-10.4529,-99.4522,
                    -20.6773,-10.4529,-97.2789,
                    -40.4509,-10.4529,-90.8541,
                    -58.4565,-10.4529,-80.4585,
                    -73.9074,-10.4529,-66.5465,
                    -86.1281,-10.4529,-49.7261,
                    -94.5847,-10.4529,-30.7324,
                    -98.9074,-10.4529,-10.3956,
                    -98.9074,-10.4529,10.3956,
                    -94.5846,-10.4529,30.7324,
                    -86.1281,-10.4529,49.7261,
                    -73.9074,-10.4529,66.5465,
                    -58.4565,-10.4529,80.4585,
                    -40.4508,-10.4529,90.8541,
                    -20.6772,-10.4529,97.2789,
                    0.0001,-10.4529,99.4522,
                    20.6774,-10.4529,97.2789,
                    40.4510,-10.4529,90.8540,
                    58.4567,-10.4529,80.4584,
                    73.9075,-10.4529,66.5464,
                    86.1282,-10.4529,49.7259,
                    94.5847,-10.4529,30.7322,
                    98.9074,-10.4529,10.3953,
                    98.9073,-10.4529,-10.3959,
                    94.5845,-10.4529,-30.7327,
                    86.1280,-10.4529,-49.7264,
                    73.9071,-10.4529,-66.5468,
                    58.4562,-10.4529,-80.4587,
                    40.4505,-10.4529,-90.8543,
                    20.6768,-10.4529,-97.2790,
                    -0.0000,-30.9017,-95.1057,
                    -19.7736,-30.9017,-93.0274,
                    -38.6830,-30.9017,-86.8833,
                    -55.9017,-30.9017,-76.9421,
                    -70.6773,-30.9017,-63.6381,
                    -82.3639,-30.9017,-47.5528,
                    -90.4509,-30.9017,-29.3892,
                    -94.5847,-30.9017,-9.9412,
                    -94.5846,-30.9017,9.9413,
                    -90.4508,-30.9017,29.3893,
                    -82.3639,-30.9017,47.5528,
                    -70.6773,-30.9017,63.6381,
                    -55.9017,-30.9017,76.9421,
                    -38.6829,-30.9017,86.8834,
                    -19.7735,-30.9017,93.0274,
                    0.0001,-30.9017,95.1057,
                    19.7737,-30.9017,93.0273,
                    38.6831,-30.9017,86.8833,
                    55.9018,-30.9017,76.9420,
                    70.6774,-30.9017,63.6380,
                    82.3640,-30.9017,47.5526,
                    90.4509,-30.9017,29.3890,
                    94.5847,-30.9017,9.9410,
                    94.5846,-30.9017,-9.9415,
                    90.4508,-30.9017,-29.3895,
                    82.3637,-30.9017,-47.5531,
                    70.6770,-30.9017,-63.6384,
                    55.9014,-30.9017,-76.9423,
                    38.6826,-30.9017,-86.8835,
                    19.7732,-30.9017,-93.0275,
                    -0.0000,-50.0000,-86.6025,
                    -18.0057,-50.0000,-84.7100,
                    -35.2244,-50.0000,-79.1153,
                    -50.9037,-50.0000,-70.0629,
                    -64.3582,-50.0000,-57.9484,
                    -75.0000,-50.0000,-43.3012,
                    -82.3639,-50.0000,-26.7616,
                    -86.1281,-50.0000,-9.0524,
                    -86.1281,-50.0000,9.0524,
                    -82.3639,-50.0000,26.7617,
                    -75.0000,-50.0000,43.3013,
                    -64.3582,-50.0000,57.9484,
                    -50.9037,-50.0000,70.0629,
                    -35.2244,-50.0000,79.1154,
                    -18.0056,-50.0000,84.7101,
                    0.0001,-50.0000,86.6025,
                    18.0058,-50.0000,84.7100,
                    35.2245,-50.0000,79.1153,
                    50.9038,-50.0000,70.0628,
                    64.3583,-50.0000,57.9483,
                    75.0001,-50.0000,43.3011,
                    82.3640,-50.0000,26.7615,
                    86.1281,-50.0000,9.0522,
                    86.1281,-50.0000,-9.0527,
                    82.3638,-50.0000,-26.7619,
                    74.9998,-50.0000,-43.3015,
                    64.3580,-50.0000,-57.9486,
                    50.9034,-50.0000,-70.0631,
                    35.2241,-50.0000,-79.1155,
                    18.0053,-50.0000,-84.7101,
                    -0.0000,-66.9131,-74.3145,
                    -15.4508,-66.9131,-72.6905,
                    -30.2264,-66.9131,-67.8896,
                    -43.6810,-66.9131,-60.1217,
                    -55.2264,-66.9131,-49.7261,
                    -64.3582,-66.9131,-37.1572,
                    -70.6773,-66.9131,-22.9644,
                    -73.9074,-66.9131,-7.7680,
                    -73.9074,-66.9131,7.7680,
                    -70.6772,-66.9131,22.9644,
                    -64.3582,-66.9131,37.1572,
                    -55.2264,-66.9131,49.7261,
                    -43.6809,-66.9131,60.1217,
                    -30.2264,-66.9131,67.8897,
                    -15.4508,-66.9131,72.6905,
                    0.0001,-66.9131,74.3145,
                    15.4509,-66.9131,72.6905,
                    30.2265,-66.9131,67.8896,
                    43.6810,-66.9131,60.1216,
                    55.2265,-66.9131,49.7260,
                    64.3583,-66.9131,37.1571,
                    70.6773,-66.9131,22.9643,
                    73.9074,-66.9131,7.7678,
                    73.9073,-66.9131,-7.7682,
                    70.6772,-66.9131,-22.9647,
                    64.3581,-66.9131,-37.1575,
                    55.2262,-66.9131,-49.7263,
                    43.6807,-66.9131,-60.1218,
                    30.2261,-66.9131,-67.8898,
                    15.4505,-66.9131,-72.6906,
                    -0.0000,-80.9017,-58.7785,
                    -12.2207,-80.9017,-57.4940,
                    -23.9074,-80.9017,-53.6968,
                    -34.5491,-80.9017,-47.5528,
                    -43.6809,-80.9017,-39.3305,
                    -50.9037,-80.9017,-29.3892,
                    -55.9017,-80.9017,-18.1635,
                    -58.4565,-80.9017,-6.1440,
                    -58.4565,-80.9017,6.1440,
                    -55.9017,-80.9017,18.1636,
                    -50.9037,-80.9017,29.3893,
                    -43.6809,-80.9017,39.3305,
                    -34.5491,-80.9017,47.5528,
                    -23.9073,-80.9017,53.6968,
                    -12.2207,-80.9017,57.4941,
                    0.0001,-80.9017,58.7785,
                    12.2208,-80.9017,57.4940,
                    23.9074,-80.9017,53.6968,
                    34.5492,-80.9017,47.5527,
                    43.6810,-80.9017,39.3304,
                    50.9037,-80.9017,29.3891,
                    55.9017,-80.9017,18.1634,
                    58.4565,-80.9017,6.1439,
                    58.4565,-80.9017,-6.1442,
                    55.9016,-80.9017,-18.1637,
                    50.9036,-80.9017,-29.3894,
                    43.6808,-80.9017,-39.3307,
                    34.5490,-80.9017,-47.5529,
                    23.9071,-80.9017,-53.6969,
                    12.2205,-80.9017,-57.4941,
                    -0.0000,-91.3546,-40.6736,
                    -8.4565,-91.3546,-39.7848,
                    -16.5435,-91.3546,-37.1572,
                    -23.9074,-91.3546,-32.9057,
                    -30.2264,-91.3546,-27.2160,
                    -35.2244,-91.3546,-20.3368,
                    -38.6829,-91.3546,-12.5688,
                    -40.4508,-91.3546,-4.2515,
                    -40.4508,-91.3546,4.2516,
                    -38.6829,-91.3546,12.5689,
                    -35.2244,-91.3546,20.3368,
                    -30.2264,-91.3546,27.2160,
                    -23.9074,-91.3546,32.9057,
                    -16.5434,-91.3546,37.1572,
                    -8.4565,-91.3546,39.7848,
                    0.0000,-91.3546,40.6736,
                    8.4566,-91.3546,39.7848,
                    16.5435,-91.3546,37.1572,
                    23.9074,-91.3546,32.9056,
                    30.2265,-91.3546,27.2159,
                    35.2244,-91.3546,20.3367,
                    38.6830,-91.3546,12.5687,
                    40.4508,-91.3546,4.2514,
                    40.4508,-91.3546,-4.2517,
                    38.6829,-91.3546,-12.5690,
                    35.2243,-91.3546,-20.3369,
                    30.2263,-91.3546,-27.2161,
                    23.9072,-91.3546,-32.9058,
                    16.5433,-91.3546,-37.1573,
                    8.4563,-91.3546,-39.7849,
                    -0.0000,-97.8148,-20.7911,
                    -4.3227,-97.8148,-20.3368,
                    -8.4565,-97.8148,-18.9936,
                    -12.2207,-97.8148,-16.8204,
                    -15.4508,-97.8148,-13.9120,
                    -18.0057,-97.8148,-10.3956,
                    -19.7735,-97.8148,-6.4248,
                    -20.6772,-97.8148,-2.1733,
                    -20.6772,-97.8148,2.1733,
                    -19.7735,-97.8148,6.4248,
                    -18.0057,-97.8148,10.3956,
                    -15.4508,-97.8148,13.9120,
                    -12.2207,-97.8148,16.8204,
                    -8.4565,-97.8148,18.9937,
                    -4.3227,-97.8148,20.3368,
                    0.0000,-97.8148,20.7911,
                    4.3227,-97.8148,20.3368,
                    8.4565,-97.8148,18.9936,
                    12.2208,-97.8148,16.8204,
                    15.4509,-97.8148,13.9120,
                    18.0057,-97.8148,10.3955,
                    19.7736,-97.8148,6.4248,
                    20.6772,-97.8148,2.1732,
                    20.6772,-97.8148,-2.1733,
                    19.7735,-97.8148,-6.4249,
                    18.0056,-97.8148,-10.3956,
                    15.4508,-97.8148,-13.9120,
                    12.2207,-97.8148,-16.8204,
                    8.4564,-97.8148,-18.9937,
                    4.3226,-97.8148,-20.3368,
                    0.0000,-100.0000,-0.0000
                ]);
        }		
    }
}
